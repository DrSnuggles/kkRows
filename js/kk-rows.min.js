const template=document.createElement("template");template.innerHTML='<style>\n:host{height:100%;display:inline-block}#kkOuter{position:relative;width:100%;min-height:100%}#fInput{width:calc(100% - 10px);text-align:center}#fInput::placeholder{text-align:center}#fInput:focus,#myTblScroll:focus{outline:0}#myTblDiv{height:calc(25vh - 39px);overflow-y:none;font:80% sans-serif}#myTblDiv table{border-spacing:0;width:calc(100% - 20px)}#myTblDiv table td,#myTblDiv table th{padding:0;overflow:hidden;text-overflow:ellipsis;display:inline-block;white-space:nowrap}#myTblDiv table td{cursor:pointer}#myTblDiv table th{background:#0001;text-align:left}#myTblScroll{position:absolute;margin:0;margin-top:22px;width:calc(25vh - 39px);transform-origin:0 0;transform:rotate(90deg)}#myTblDiv table td.hidden{display:none}\n</style>\n<div id="kkOuter">\n\t<input id="fInput" placeholder="Type search term"/>\n\t<input type="range" id="myTblScroll" min="0" max="1" step="0.0000001" value="0"/>\n\t<div id="myTblDiv"></div>\n</div>\n',window.kkRowsCallback=(e,t)=>{const a={from:e.parentElement.parentElement.getRootNode().host.id};e.querySelectorAll("td").forEach(((e,t)=>{a[t]=e.innerHTML})),t(a)};export class kkRows extends HTMLElement{static get observedAttributes(){return["data","src","head","cb","hide"]}constructor(){super(),this._shadowRoot=this.attachShadow({mode:"closed"}),this._shadowRoot.appendChild(template.content.cloneNode(!0)),this.initWorker(),this.initHandler()}initWorker(){const e=new Blob(['\nlet data=[],filtered=[],actRow=0,dispCnt=1,head=[],callback=!1,hide=[];function filter(e){console.time("Filter");const t=e.split(" ");if(""===t[0])filtered=[...data];else{filtered=[];const e=t.length;data.forEach((a=>{const o=a.join("|").toLowerCase();let s=0;for(let a=0;a<e;a++){const e=t[a].toLowerCase();if(!(o.indexOf(e)>-1))break;s++}s===e&&filtered.push(a)}))}console.timeEnd("Filter"),actRow=0,sendRows()}function sendRows(e=-1,t){const a=filtered.length;actRow+=1==e?dispCnt/2:-dispCnt/2,t==1*t&&(actRow=t*a),actRow=Math.floor(actRow),actRow>a-dispCnt&&(actRow=a-dispCnt),actRow<0&&(actRow=0);let o=actRow+dispCnt;const s=filtered.slice(actRow,o);postMessage({tbl:makeTbl(s),actRow:actRow,endRow:o,len:a})}function makeTbl(e){let t=[];if(t.push("<table>"),head.length>0&&(t.push("<thead>"),head.forEach((e=>{t.push(\'<th width="\'+100/head.length+\'%">\'+e+"</th>")})),t.push("</thead>")),e.length>0){const a=callback?\' onclick="kkRowsCallback(this, \'+callback+\')"\':"",o=100/(e[0].length-hide.length);e.forEach((e=>{t.push("<tr"+a+">"),e.forEach(((e,a)=>{const s=-1!==hide.indexOf(a+"")?\' class="hidden"\':"";t.push("<td"+s+\' width="\'+o+\'%" title="\'+e+\'">\'+e+"</td>")})),t.push("</tr>")}))}return t.push("</table>"),t=t.join(""),t}function loadURL(e){console.time("loadURL: "+e),fetch(e).then((e=>e.text())).then((t=>{console.timeEnd("loadURL: "+e),JSONorCSV(t)})).catch((e=>console.error(e)))}function JSONorCSV(e){try{parseJSON(JSON.parse(e))}catch(t){parseCSV(e)}}function parseCSV(e){console.time("parseCSV"),data=[];e.split(String.fromCharCode(10)).forEach((e=>{const t=e.split("|");""!=e&&data.push(t)})),filtered=[...data],console.timeEnd("parseCSV"),actRow=0,sendRows(),postMessage({resizeNeeded:!0})}function parseJSON(e){console.time("parseJSON"),data=e,filtered=[...data],console.timeEnd("parseJSON"),actRow=0,sendRows(),postMessage({resizeNeeded:!0})}onmessage=function(e){if(e.data.scroll)return e.data.scroll.deltaY>0&&sendRows(1),void(e.data.scroll.deltaY<0&&sendRows(-1));if(e.data.scrollTo!=1*e.data.scrollTo)if("string"!=typeof e.data.filter){if(e.data.resize)return dispCnt=e.data.resize.rows,head.length>0&&dispCnt--,void sendRows(-1,actRow/filtered.length);if(e.data.cb)callback=e.data.cb;else if(e.data.src)loadURL(e.data.src);else if(e.data.data)JSONorCSV(e.data.data);else if(e.data.head)head=e.data.head.split("|");else if(e.data.hide)hide=e.data.hide.split("|");else if("getRows"===e.data.msg)sendRows(e.data.dir,e.data.scrollTo);else console.error("Unknown message from Module got: ",e.data)}else filter(e.data.filter);else sendRows(e.data.dir,e.data.scrollTo)};\n'],{type:"text/javascript"}),t=new Worker(URL.createObjectURL(e));this.worker=t,t.onmessage=e=>{const t=e.data;if(t.tbl){const e=this._shadowRoot.getElementById("myTblScroll");e.value=t.actRow/t.len,e.title=`${t.actRow}-${t.endRow<t.len?t.endRow:t.len} / ${t.len}`;const a=this._shadowRoot.getElementById("myTblDiv");0===a.childNodes.length?(a.innerHTML=t.tbl,this.resizer()):(a.childNodes[0].remove(),a.innerHTML=t.tbl)}else e.data.resizeNeeded&&this.resizer()}}initHandler(){new ResizeObserver((e=>{for(let t of e){t.contentRect;this.resizer()}})).observe(this._shadowRoot.host),this.addEventListener("wheel",(e=>{this.worker.postMessage({scroll:{deltaX:e.deltaX,deltaY:e.deltaY}})}),{passive:!0}),this._shadowRoot.getElementById("myTblScroll").oninput=e=>{this.worker.postMessage({scrollTo:1*e.target.value})},this.keyTimer=null,this.lastInput="",this._shadowRoot.getElementById("fInput").onkeyup=e=>{const t=e.target.value;this.lastInput!==t&&(this.keyTimer&&(clearTimeout(this.keyTimer),this.keyTimer=null),this.keyTimer=setTimeout((()=>{this.worker.postMessage({filter:this._shadowRoot.getElementById("fInput").value})}),500),this.lastInput=t)}}resizer(){const e=this._shadowRoot.getElementById("myTblDiv"),t=this._shadowRoot.getElementById("kkOuter").offsetHeight-21;this._shadowRoot.getElementById("myTblScroll").style.width=t+"px",this.worker.postMessage({resize:{rows:e.getElementsByTagName("tr")[0]?Math.floor(t/e.getElementsByTagName("tr")[0].offsetHeight):1}})}attributeChangedCallback(e,t,a){this.worker.postMessage({[e]:a})}}customElements.define("kk-rows",kkRows);