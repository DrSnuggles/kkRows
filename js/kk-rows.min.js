const template=document.createElement("template");template.innerHTML='<style>\n:host{height:100%;display:inline-block}#kkOuter{position:relative;width:100%;min-height:100%}#fInput{width:calc(100% - 10px);text-align:center}#fInput::placeholder{text-align:center}#fInput:focus,#myTblScroll:focus{outline:0}#myTblDiv{height:calc(25vh - 39px);overflow-y:none;font:80% sans-serif}#myTblDiv table{border-spacing:0;width:calc(100% - 20px)}#myTblDiv table td,#myTblDiv table th{padding:0;overflow:hidden;text-overflow:ellipsis;display:inline-block;white-space:nowrap}#myTblDiv table td{cursor:pointer}#myTblDiv table th{background:#0001}#myTblScroll{position:absolute;margin:0;margin-top:22px;width:calc(25vh - 39px);transform-origin:0 0;transform:rotate(90deg)}#myTblDiv table td.hidden{display:none}\n</style>\n<div id="kkOuter">\n\t<input id="fInput" placeholder="Type search term"/>\n\t<input type="range" id="myTblScroll" min="0" max="1" step="0.0000001" value="0"/>\n\t<div id="myTblDiv"></div>\n</div>\n',window.kkRowsCallback=(t,e,a)=>{const o=["LMB","RMB","DBL"];let s;t.parentElement?(s={from:t.parentElement.parentElement.getRootNode().host.id,sel:t.innerText,ev:o[a]},t.parentElement.querySelectorAll("td").forEach(((t,e)=>{s[e]=t.innerHTML}))):s={rng:t,ev:"RNG"},e(s)};export class kkRows extends HTMLElement{static get observedAttributes(){return["data","src","head","cb","hide","css"]}constructor(){super(),this._shadowRoot=this.attachShadow({mode:"closed"}),this._shadowRoot.appendChild(template.content.cloneNode(!0)),this.initWorker(),this.initHandler()}initWorker(){const blob=new Blob(['\nlet data=[],filtered=[],actRow=0,dispCnt=1,head=[],callback=!1,hide=[];function filter(t){console.time("Filter");const e=t.split(" ");if(""===e[0])filtered=[...data];else{filtered=[];const t=e.length;data.forEach((a=>{const o=a.join("|").toLowerCase();let s=0;for(let a=0;a<t;a++){const t=e[a].toLowerCase();if(!(o.indexOf(t)>-1))break;s++}s===t&&filtered.push(a)}))}console.timeEnd("Filter"),actRow=0,sendRows()}function sendRows(t=-1,e){const a=filtered.length;actRow+=1==t?dispCnt/2:-dispCnt/2,e==1*e&&(actRow=e*a),actRow=Math.floor(actRow),actRow>a-dispCnt&&(actRow=a-dispCnt),actRow<0&&(actRow=0);let o=actRow+dispCnt;const s=filtered.slice(actRow,o);postMessage({tbl:makeTbl(s),actRow:actRow,endRow:o,len:a})}function getRandom(t,e=1,a=filtered){const o=a[getRandomInt(0,a.length-1)];postMessage({rng:o,callback:t})}function getRandomInt(t,e){const a=new Uint32Array(1);crypto.getRandomValues(a);const o=e-t+1;return a[0]>=Math.floor(4294967295/o)*o?getRandomInt(t,e):t+a[0]%o}function makeTbl(t){let e=[];if(e.push("<table>"),head.length>0&&(e.push("<thead>"),head.forEach((t=>{e.push(\'<th width="\'+100/head.length+\'%">\'+t+"</th>")})),e.push("</thead>")),t.length>0){let a="",o="",s="";callback&&(a=\' onclick="kkRowsCallback(this,\'+callback+\',0)"\',o=\' ondblclick="kkRowsCallback(this,\'+callback+\',2)"\',s=\' oncontextmenu="kkRowsCallback(this,\'+callback+\',1)"\');const d=100/(t[0].length-hide.length);t.forEach((t=>{e.push("<tr>"),t.forEach(((t,l)=>{const n=-1!==hide.indexOf(l+"")?\' class="hidden"\':"";e.push("<td"+a+s+o+n+\' width="\'+d+\'%" title="\'+t+\'">\'+t+"</td>")})),e.push("</tr>")}))}return e.push("</table>"),e=e.join(""),e}function loadURL(t){console.time("loadURL: "+t),fetch(t).then((t=>t.text())).then((e=>{console.timeEnd("loadURL: "+t),JSONorCSV(e)})).catch((t=>console.error(t)))}function JSONorCSV(t){try{parseJSON(JSON.parse(t))}catch(e){parseCSV(t)}}function parseCSV(t){console.time("parseCSV"),data=[];t.split(String.fromCharCode(10)).forEach((t=>{const e=t.split("|");""!=t&&data.push(e)})),"csv"==head&&(head=data[0],data.splice(0,1)),filtered=[...data],console.timeEnd("parseCSV"),actRow=0,sendRows(),postMessage({resizeNeeded:!0})}function parseJSON(t){console.time("parseJSON"),data=t,filtered=[...data],console.timeEnd("parseJSON"),actRow=0,sendRows(),postMessage({resizeNeeded:!0})}onmessage=function(t){if(t.data.scroll)return t.data.scroll.deltaY>0&&sendRows(1),void(t.data.scroll.deltaY<0&&sendRows(-1));if(t.data.scrollTo!=1*t.data.scrollTo)if("string"!=typeof t.data.filter){if(t.data.resize)return dispCnt=t.data.resize.rows,head.length>0&&dispCnt--,void sendRows(-1,actRow/filtered.length);if(t.data.cb)callback=t.data.cb;else if(t.data.src)loadURL(t.data.src);else if(t.data.data)JSONorCSV(t.data.data);else if(t.data.head)head=t.data.head.split("|");else if(t.data.hide)hide=t.data.hide.split("|");else switch(t.data.msg){case"getRows":sendRows(t.data.dir,t.data.scrollTo);break;case"getRandom":getRandom(t.data.callback);break;default:console.error("Unknown message from Module got: ",t.data)}}else filter(t.data.filter);else sendRows(t.data.dir,t.data.scrollTo)};\n'],{type:"text/javascript"}),worker=new Worker(URL.createObjectURL(blob));this.worker=worker,worker.onmessage=e=>{const dat=e.data;if(dat.tbl){const t=this._shadowRoot.getElementById("myTblScroll");t.value=dat.actRow/dat.len,t.title=`${dat.actRow+1}-${dat.endRow<dat.len?dat.endRow:dat.len} / ${dat.len}`;const e=this._shadowRoot.getElementById("myTblDiv");0===e.childNodes.length?(e.innerHTML=dat.tbl,this.resizer()):(e.childNodes[0].remove(),e.innerHTML=dat.tbl)}else e.data.resizeNeeded?this.resizer():e.data.rng?window.kkRowsCallback(e.data.rng,eval(e.data.callback)):console.log("Unknown message:",e)}}initHandler(){new ResizeObserver((t=>{for(let e of t){e.contentRect;this.resizer()}})).observe(this._shadowRoot.host),this.addEventListener("wheel",(t=>{this.worker.postMessage({scroll:{deltaX:t.deltaX,deltaY:t.deltaY}})}),{passive:!0}),this._shadowRoot.getElementById("myTblScroll").oninput=t=>{this.worker.postMessage({scrollTo:1*t.target.value})},this.keyTimer=null,this.lastInput="",this._shadowRoot.getElementById("fInput").onkeyup=t=>{const e=t.target.value;this.lastInput!==e&&(this.keyTimer&&(clearTimeout(this.keyTimer),this.keyTimer=null),this.keyTimer=setTimeout((()=>{this.worker.postMessage({filter:this._shadowRoot.getElementById("fInput").value})}),500),this.lastInput=e)}}resizer(){const t=this._shadowRoot.getElementById("myTblDiv"),e=this._shadowRoot.getElementById("kkOuter").offsetHeight-21;this._shadowRoot.getElementById("myTblScroll").style.width=e+"px",this.worker.postMessage({resize:{rows:t.getElementsByTagName("tr")[0]?Math.floor(e/t.getElementsByTagName("tr")[0].offsetHeight):1}})}attributeChangedCallback(t,e,a){"css"!=t?this.worker.postMessage({[t]:a}):this._shadowRoot.children[0].insertAdjacentHTML("afterEnd",`<style>${a.replace(/\n/g,"")}</style>`)}}customElements.define("kk-rows",kkRows);